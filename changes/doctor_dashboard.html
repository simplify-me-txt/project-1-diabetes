{% extends "base.html" %}
{% block content %}

<!-- Animate    <div class="container mt-4">
        <!-- Dashboard Header -->
<div class="row align-items-center mb-5">
    <div class="col-md-6 offset-md-3">
        <div class="text-center">
            <h2 class="text-center text-primary mb-2">üë®‚Äç‚öïÔ∏è {{ t['doctor_dashboard'] }}</h2>
            <p class="text-center text-muted col-8 offset-2">{{ t['analytics_patients'] }}</p>
        </div>
    </div>
    <div class="col-md-3 text-end">
        <a href="{{ url_for('logout') }}" class="btn btn-outline-danger">
            <i class="fas fa-sign-out-alt"></i> {{ t['logout'] }}
        </a>
        <div class="text-center text-muted mb-4">
            Page {{ page }} of {{ total_pages }} ({{ total_records }} total records)
        </div>
        {% endif %}
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // ‚úÖ Pass Python dict to JS safely
    const stages = {{ stages | tojson }};

    // Pie Chart: Diabetic vs Non-Diabetic
    new Chart(document.getElementById('pieChart'), {
        type: 'pie',
        data: {
            labels: ['Diabetic', 'Non-Diabetic'],
            datasets: [{
                data: [{{ diabetic_count| tojson }}, {{ non_diabetic_count| tojson }}],
        backgroundColor: ['#dc3545', '#28a745']
            }]
        },
        options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: 'Diabetic vs Non-Diabetic'
            }
        }
    }
    });

    // Bar Chart: Avg Glucose & BMI
    new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
            labels: ['Average Glucose', 'Average BMI'],
            datasets: [{
                label: 'Health Stats',
                data: [{{ avg_glucose| tojson }}, {{ avg_bmi| tojson }}],
        backgroundColor: ['#007bff', '#17a2b8']
            }]
        },
        options: {
        scales: { y: { beginAtZero: true } },
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: 'Average Health Metrics'
            }
        }
    }
    });

    // Doughnut Chart: Stages
    const stageLabels = Object.keys(stages);
    const stageValues = Object.values(stages);

    if (stageValues.some(v => v > 0)) {
        new Chart(document.getElementById('stageChart'), {
            type: 'doughnut',
            data: {
                labels: stageLabels,
                datasets: [{
                    data: stageValues,
                    backgroundColor: ['#28a745', '#ffc107', '#ff5733', '#6f42c1']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Patient Stages Distribution'
                    }
                }
            }
        });
    } else {
        document.getElementById('stageChart').parentElement.innerHTML =
            "<p class='text-center text-muted'>No stage data available</p>";
    }
</script>

<style>
    /* Force transparent table background and apply gradient rows */
    .history-table table {
        background: transparent !important;
    }

    .history-table table tbody {
        background: transparent !important;
    }

    .history-table table tbody tr:nth-child(odd) {
        background: linear-gradient(135deg, rgba(240, 147, 251, 0.2), rgba(102, 126, 234, 0.2)) !important;
    }

    .history-table table tbody tr:nth-child(even) {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.25), rgba(240, 147, 251, 0.25)) !important;
    }

    .history-table table tbody tr {
        border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        transition: background 0.2s ease;
    }

    /* Fix hover overflow issue */
    .history-table table tbody tr:hover {
        background: rgba(102, 126, 234, 0.3) !important;
        transform: scale(1);
    }
</style>

< !-- Charts Section -->
    <div class="row mb-5">
        <div class="col-md-6 mb-4">
            <div class="card border-0 shadow-sm rounded-4 h-100">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="mb-0 fw-bold text-primary"> {
                        {
                        t['diabetes_distribution']
                        }
                        }

                    </h5>
                </div>
                <div class="card-body"><canvas id="diabetesDistributionChart"></canvas></div>
            </div>
        </div>
        <div class="col-md-6 mb-4">
            <div class="card border-0 shadow-sm rounded-4 h-100">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="mb-0 fw-bold text-primary"> {
                        {
                        t['patient_stages']
                        }
                        }

                    </h5>
                </div>
                <div class="card-body"><canvas id="stagesChart"></canvas></div>
            </div>
        </div>
    </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script> // Diabetes Distribution Chart
        const distCtx = document.getElementById('diabetesDistributionChart').getContext('2d');

        new Chart(distCtx, {

            type: 'doughnut',
            data: {

                labels: ["{{ t['diabetic'] }}", "{{ t['non_diabetic'] }}"],
                datasets: [{
                    data: [{
                            {
                        stats.diabetic_count
                    }
                    }

                    , {
                        {
                    stats.non_diabetic_count
                }
                }

                ],
            backgroundColor: ['#dc3545', '#198754'],
            hoverOffset: 4
        }

            ]
        }

        ,
            options: {

            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

        // Stages Chart
        const stagesCtx = document.getElementById('stagesChart').getContext('2d');

        const stageData = {
            {
            stats.stage_distribution | tojson
        }
    }

        ;
        const stageLabels = Object.keys(stageData);
        const stageCounts = Object.values(stageData);

        new Chart(stagesCtx, {

            type: 'bar',
            data: {

                labels: stageLabels,
                datasets: [{
                    label: "{{ t['number_of_patients'] }}",
                    data: stageCounts,
                    backgroundColor: '#0d6efd',
                    borderRadius: 5
                }

                ]
            }

            ,
            options: {

                responsive: true,
                scales: {
                    y: {

                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }

                ,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    </script>
    <style>
        /* Floating shapes animation remains */
        .floating-shapes-container {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            overflow: hidden;
        }

        .floating-shape {
            position: absolute;
            opacity: 0.5;
            z-index: -1;
            will-change: transform;
        }

        .shape-1 {
            top: 10%;
            left: 10%;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            animation: floatShape 20s infinite ease-in-out;
            animation-delay: 0s;
        }

        .shape-2 {
            top: 50%;
            right: 15%;
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            animation: floatShape 25s infinite ease-in-out;
            animation-delay: -7s;
        }

        .shape-3 {
            bottom: 20%;
            left: 20%;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border-radius: 50%;
            animation: floatShape 22s infinite ease-in-out;
            animation-delay: -14s;
        }

        @keyframes floatShape {

            0%,
            100% {
                transform: translateY(0) scale(1);
            }

            50% {
                transform: translateY(-30px) scale(1.05);
            }
        }
    </style>
    {% endblock %}